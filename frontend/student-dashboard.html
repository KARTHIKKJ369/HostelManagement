<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Dashboard - Hostel Management System</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="static/css/style.css">
    <link rel="stylesheet" href="static/css/modals.css">
</head>
<body>
    <div class="header">
        <div class="container">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <div>
                    <h1 style="margin: 0; font-size: 2.5rem;">Student Dashboard</h1>
                    <p style="margin: 0.5rem 0 0 0;">Welcome to your hostel management portal</p>
                </div>
                <div style="display: flex; gap: 1rem; align-items: center;">
                    <button class="btn btn-icon" onclick="viewNotifications()" title="View Notifications">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/>
                            <path d="M13.73 21a2 2 0 0 1-3.46 0"/>
                        </svg>
                        <span class="notification-badge" id="notificationBadge" style="display: none;">0</span>
                    </button>
                    <button class="btn btn-primary" onclick="editProfile()">Edit Profile</button>
                    <button class="btn btn-secondary" onclick="openChangePasswordModal()">Change Password</button>
                    <button class="btn btn-outline" onclick="logout()">Logout</button>
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="dashboard-grid">
            <!-- Personal Information Card -->
            <div class="dashboard-card">
                <h3>
                    <svg aria-hidden="true" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="flex-shrink:0;">
                        <path d="M20 21v-2a4 4 0 0 0-3-3.87"/>
                        <path d="M4 21v-2a4 4 0 0 1 4-4h8"/>
                        <circle cx="12" cy="7" r="4"/>
                    </svg>
                    Personal Information
                </h3>
                <div class="info-grid">
                    <div class="info-item">
                        <span class="info-label">Name:</span>
                        <span class="info-value" id="studentName">Loading...</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Student ID:</span>
                        <span class="info-value" id="studentId">Loading...</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Course:</span>
                        <span class="info-value" id="course">Loading...</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Year of Study:</span>
                        <span class="info-value" id="yearOfStudy">Loading...</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Phone:</span>
                        <span class="info-value" id="phone">Loading...</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Email:</span>
                        <span class="info-value" id="email">Loading...</span>
                    </div>
                </div>
            </div>

            <!-- Room Allotment Card (shown when no room assigned) -->
            <div class="dashboard-card" id="allotmentCard" style="display: none;">
                <h3>
                    <svg aria-hidden="true" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="flex-shrink:0;">
                        <path d="M3 9l9-7 9 7"/>
                        <path d="M9 22V12h6v10"/>
                    </svg>
                    Room Allotment
                </h3>
                <p>Apply for hostel room allocation. Complete your registration to secure accommodation.</p>
                <div class="button-group">
                    <button class="btn btn-primary" onclick="openAllotmentModal()">Apply for Allotment</button>
                </div>
            </div>

            <!-- Room Information Card (shown when room assigned) -->
            <div class="dashboard-card" id="roomInfoCard">
                <h3>
                    <svg aria-hidden="true" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="flex-shrink:0;">
                        <path d="M3 9l9-7 9 7"/>
                        <path d="M9 22V12h6v10"/>
                    </svg>
                    Room Information
                </h3>
                <div id="roomInfo">
                    <!-- Room information will be populated here -->
                </div>
                <div class="button-group">
                    <button class="btn btn-primary" onclick="viewRoomDetails()">View Room Details</button>
                </div>
            </div>

            <!-- Maintenance Requests Card -->
            <div class="dashboard-card">
                <h3>
                    <svg aria-hidden="true" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="flex-shrink:0;">
                        <path d="M14.7 6.3a1 1 0 0 1 1.4 0l1.6 1.6a1 1 0 0 1 0 1.4l-8.8 8.8a4 4 0 1 1-5.7-5.7l8.8-8.8a1 1 0 0 1 1.4 0z"/>
                    </svg>
                    Maintenance Requests
                </h3>
                <div id="maintenanceRequests">
                    <!-- Maintenance requests will be populated here -->
                </div>
            </div>

            <!-- Quick Actions Card -->
            <div class="dashboard-card">
                <h3>
                    <svg aria-hidden="true" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="flex-shrink:0;">
                        <polyline points="13 2 13 9 20 9"/>
                        <polyline points="11 22 11 15 4 15"/>
                    </svg>
                    Quick Actions
                </h3>
                <div class="button-group">
                    <button class="btn btn-primary" onclick="reportIssue()">Report Issue</button>
                    <button class="btn btn-primary" onclick="viewHostelRules()">Hostel Rules</button>
                    <button class="btn btn-primary" onclick="contactWarden()">Contact Warden</button>
                    <button class="btn btn-primary" onclick="viewFacilities()">View Facilities</button>
                </div>
            </div>

            <!-- Recent Activity Card -->
            <div class="dashboard-card">
                <h3>
                    <svg aria-hidden="true" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="flex-shrink:0;">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                        <polyline points="14 2 14 8 20 8"/>
                        <line x1="16" y1="13" x2="8" y2="13"/>
                        <line x1="16" y1="17" x2="8" y2="17"/>
                    </svg>
                    Recent Activity
                </h3>
                <div id="recentActivity">
                    <!-- Recent activity will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Allotment Registration Modal -->
    <div id="allotmentModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>
                    <svg aria-hidden="true" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="flex-shrink:0; margin-right:6px;">
                        <rect x="3" y="7" width="18" height="13" rx="2" ry="2"></rect>
                        <path d="M7 7V5a3 3 0 0 1 3-3h4a3 3 0 0 1 3 3v2"></path>
                        <path d="M7 10h10"></path>
                        <path d="M7 14h10"></path>
                    </svg>
                    Hostel Allotment Registration
                </h3>
                <span class="close" onclick="closeAllotmentModal()">&times;</span>
            </div>
            <div class="modal-body">
                <form id="allotmentForm">
                    <div class="form-section">
                        <h4>Personal Information</h4>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="studentId" class="form-label">Student ID *</label>
                                <input type="text" id="studentId" name="studentId" class="form-input" required placeholder="Enter your student ID" style="color: #000 !important; background: #fff !important;">
                            </div>
                            <div class="form-group">
                                <label for="studentName" class="form-label">Full Name *</label>
                                <input type="text" id="studentName" name="studentName" class="form-input" required placeholder="Enter your full name" style="color: #000 !important; background: #fff !important;">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="course" class="form-label">Course *</label>
                                <input type="text" id="course" name="course" class="form-input" required style="color: #000 !important; background: #fff !important;">
                            </div>
                            <div class="form-group">
                                <label for="yearOfStudy" class="form-label">Year of Study *</label>
                                <select id="yearOfStudy" name="yearOfStudy" class="form-select" required onchange="toggleAcademicField()" style="color: #000 !important; background: #fff !important;">
                                    <option value="">Select Year</option>
                                    <option value="1">1st Year</option>
                                    <option value="2">2nd Year</option>
                                    <option value="3">3rd Year</option>
                                    <option value="4">4th Year</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="phoneNumber" class="form-label">Phone Number *</label>
                                <input type="tel" id="phoneNumber" name="phoneNumber" class="form-input" required>
                            </div>
                            <div class="form-group">
                                <label for="studentEmail" class="form-label">Email Address *</label>
                                <input type="email" id="studentEmail" name="studentEmail" class="form-input" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="academicScore" class="form-label" id="academicScoreLabel">Rank/CGPA *</label>
                                <input type="text" id="academicScore" name="academicScore" class="form-input" placeholder="Enter rank (for 1st year) or CGPA" required>
                                <small id="academicScoreHelp" class="form-text">For 1st year: Enter your entrance exam rank</small>
                            </div>
                            <div class="form-group">
                                <!-- Empty to maintain grid layout -->
                            </div>
                        </div>
                    </div>

                    <div class="form-section">
                        <h4>Emergency Contact</h4>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="emergencyContactName" class="form-label">Emergency Contact Name *</label>
                                <input type="text" id="emergencyContactName" name="emergencyContactName" class="form-input" required>
                            </div>
                            <div class="form-group">
                                <label for="emergencyContactPhone" class="form-label">Emergency Contact Phone *</label>
                                <input type="tel" id="emergencyContactPhone" name="emergencyContactPhone" class="form-input" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="relationship" class="form-label">Relationship *</label>
                                <select id="relationship" name="relationship" class="form-select" required>
                                    <option value="">Select Relationship</option>
                                    <option value="parent">Parent</option>
                                    <option value="guardian">Guardian</option>
                                    <option value="sibling">Sibling</option>
                                    <option value="relative">Relative</option>
                                    <option value="friend">Friend</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <!-- Empty to maintain grid layout -->
                            </div>
                        </div>
                    </div>

                    <div class="form-section">
                        <h4>Address & Distance Information</h4>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="homeAddress" class="form-label">Home Address *</label>
                                <textarea id="homeAddress" name="homeAddress" class="form-textarea" required placeholder="Enter your complete home address"></textarea>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="distanceFromHome" class="form-label">Distance from Home *</label>
                                <input type="number" id="distanceFromHome" name="distanceFromHome" class="form-input" required placeholder="Enter distance" min="0" step="0.1">
                            </div>
                            <div class="form-group">
                                <label for="distanceUnit" class="form-label">Distance Unit *</label>
                                <select id="distanceUnit" name="distanceUnit" class="form-select" required>
                                    <option value="">Select Unit</option>
                                    <option value="km">Kilometers</option>
                                    <option value="miles">Miles</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="form-section">
                        <h4>Medical & Special Information</h4>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="medicalInfo" class="form-label">Medical Information</label>
                                <textarea id="medicalInfo" name="medicalInfo" class="form-textarea" placeholder="Any medical conditions, allergies, or health concerns that the hostel should be aware of"></textarea>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="specialRequests" class="form-label">Special Requests</label>
                                <textarea id="specialRequests" name="specialRequests" class="form-textarea" placeholder="Any special accommodation requests or preferences"></textarea>
                            </div>
                        </div>
                    </div>

                    <div class="form-section">
                        <h4>Accommodation Preferences</h4>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="hostelPreference" class="form-label">Preferred Hostel *</label>
                                <select id="hostelPreference" name="hostelPreference" class="form-select" required>
                                    <option value="">Select Hostel</option>
                                    <option value="boys-hostel-a">Boys Hostel A</option>
                                    <option value="boys-hostel-b">Boys Hostel B</option>
                                    <option value="girls-hostel-a">Girls Hostel A</option>
                                    <option value="girls-hostel-b">Girls Hostel B</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="roomType" class="form-label">Room Type *</label>
                                <select id="roomType" name="roomType" class="form-select" required>
                                    <option value="">Select Room Type</option>
                                    <option value="single">Single Occupancy</option>
                                    <option value="double">Double Occupancy</option>
                                    <option value="triple">Triple Occupancy</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="floorPreference" class="form-label">Floor Preference</label>
                                <select id="floorPreference" name="floorPreference" class="form-select">
                                    <option value="">No Preference</option>
                                    <option value="ground">Ground Floor</option>
                                    <option value="1">1st Floor</option>
                                    <option value="2">2nd Floor</option>
                                    <option value="3">3rd Floor</option>
                                    <option value="4">4th Floor</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <!-- Empty to maintain grid layout -->
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="additionalNotes" class="form-label">Additional Notes (Optional)</label>
                            <textarea id="additionalNotes" name="additionalNotes" class="form-textarea" placeholder="Any specific requirements or preferences..."></textarea>
                        </div>
                    </div>

                    <div class="form-section">
                        <div class="form-checkbox-container">
                            <input type="checkbox" id="agreeTerms" name="agreeTerms" class="form-checkbox" required>
                            <label for="agreeTerms" class="form-label">I agree to the hostel terms and conditions *</label>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-outline" onclick="closeAllotmentModal()">Cancel</button>
                <button type="submit" id="submitAllotmentBtn" class="btn btn-primary" form="allotmentForm">Submit Application</button>
            </div>
        </div>
    </div>

    <!-- Removed duplicate General and Room Details modals to prevent duplicate Close buttons -->

    <!-- Change Password Modal -->
    <div id="changePasswordModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>
                    <svg aria-hidden="true" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="flex-shrink:0;">
                        <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
                        <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
                    </svg>
                    Change Password
                </h3>
                <span class="close" onclick="closePasswordModal()">&times;</span>
            </div>
            <div class="modal-body">
                <form id="changePasswordForm">
                    <div class="form-group">
                        <label for="currentPassword" class="form-label">Current Password *</label>
                        <div class="password-container">
                            <input type="password" id="currentPassword" name="currentPassword" class="form-input" required>
                            <button type="button" class="password-toggle" onclick="togglePasswordVisibility('currentPassword')">
                                <svg class="eye-icon eye-open" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                                    <circle cx="12" cy="12" r="3"/>
                                </svg>
                                <svg class="eye-icon eye-closed" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display: none;">
                                    <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"/>
                                    <line x1="1" y1="1" x2="23" y2="23"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="newPassword" class="form-label">New Password *</label>
                        <div class="password-container">
                            <input type="password" id="newPassword" name="newPassword" class="form-input" required>
                            <button type="button" class="password-toggle" onclick="togglePasswordVisibility('newPassword')">
                                <svg class="eye-icon eye-open" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                                    <circle cx="12" cy="12" r="3"/>
                                </svg>
                                <svg class="eye-icon eye-closed" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display: none;">
                                    <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"/>
                                    <line x1="1" y1="1" x2="23" y2="23"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="confirmPassword" class="form-label">Confirm New Password *</label>
                        <div class="password-container">
                            <input type="password" id="confirmPassword" name="confirmPassword" class="form-input" required>
                            <button type="button" class="password-toggle" onclick="togglePasswordVisibility('confirmPassword')">
                                <svg class="eye-icon eye-open" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                                    <circle cx="12" cy="12" r="3"/>
                                </svg>
                                <svg class="eye-icon eye-closed" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display: none;">
                                    <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"/>
                                    <line x1="1" y1="1" x2="23" y2="23"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-outline" onclick="closePasswordModal()">Cancel</button>
                <button type="submit" class="btn btn-primary" id="changePasswordBtn" form="changePasswordForm">Change Password</button>
            </div>
        </div>
    </div>

    <!-- General Purpose Modal (single source of truth) -->
    <div id="generalModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="generalModalTitle">Modal Title</h3>
                <span class="close" onclick="closeGeneralModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div id="generalModalContent">
                    <!-- Dynamic content will be inserted here -->
                </div>
            </div>
            <div class="modal-footer" id="generalModalActions">
                <!-- Dynamic action buttons will be inserted here -->
            </div>
        </div>
    </div>

    <!-- Edit Profile Modal -->
    <div id="editProfileModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>
                    <svg aria-hidden="true" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="flex-shrink:0; margin-right:6px;">
                        <path d="M12 20h9"/>
                        <path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4 12.5-12.5z"/>
                    </svg>
                    Edit Profile
                </h3>
                <span class="close" onclick="closeEditProfileModal()">&times;</span>
            </div>
            <div class="modal-body">
                <form id="editProfileForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="editUsername" class="form-label">Username *</label>
                            <input type="text" id="editUsername" name="username" class="form-input" required>
                        </div>
                        <div class="form-group">
                            <label for="editFullName" class="form-label">Full Name *</label>
                            <input type="text" id="editFullName" name="fullName" class="form-input" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="editEmail" class="form-label">Email *</label>
                            <input type="email" id="editEmail" name="email" class="form-input" required>
                        </div>
                        <div class="form-group">
                            <label for="editPhone" class="form-label">Phone Number *</label>
                            <input type="tel" id="editPhone" name="phone" class="form-input" required>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-outline" onclick="closeEditProfileModal()">Cancel</button>
                <button type="submit" class="btn btn-primary" form="editProfileForm">Update Profile</button>
            </div>
        </div>
    </div>

    <!-- Room Details Modal (single) -->
    <div id="roomDetailsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>
                    <svg aria-hidden="true" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="flex-shrink:0; margin-right:6px;">
                        <path d="M3 9l9-7 9 7"/>
                        <path d="M9 22V12h6v10"/>
                    </svg>
                    Room Details
                </h3>
                <span class="close" onclick="closeRoomDetailsModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div id="roomDetailsContent">
                    <!-- Room details will be populated here -->
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-outline" onclick="closeRoomDetailsModal()">Close</button>
            </div>
        </div>
    </div>

    <script src="static/js/auth.js"></script>
    <script src="static/js/student-dashboard.js"></script>
</body>
</html>